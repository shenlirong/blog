import F from"@temp/slimsearch/index.js";import{sortStrategy as b}from"@temp/slimsearch/worker-options.js";import{search as $,getStoredFields as w,autoSuggest as L,loadJSONIndex as O}from"slimsearch";import{entries as k}from"@vuepress/helper/shared";const S=(e,n)=>{const o=e.toLowerCase(),l=n.toLowerCase(),i=[];let s=0,t=0;const d=(c,f=!1)=>{let p;t===0?p=c.length>20?`… ${c.slice(-20)}`:c:f?p=c.length+t>100?`${c.slice(0,100-t)}… `:c:p=c.length>20?`${c.slice(0,20)} … ${c.slice(-20)}`:c,p&&i.push(p),t+=p.length,f||(i.push(["mark",n]),t+=n.length,t>=100&&i.push(" …"))};let r=o.indexOf(l,s);if(r===-1)return null;for(;r>=0;){const c=r+l.length;if(d(e.slice(s,r)),s=c,t>100)break;r=o.indexOf(l,s)}return t<100&&d(e.slice(s),!0),i},I=(e,n)=>n.contents.reduce((o,[,l])=>o+l,0)-e.contents.reduce((o,[,l])=>o+l,0),N=(e,n)=>Math.max(...n.contents.map(([,o])=>o))-Math.max(...e.contents.map(([,o])=>o)),z=(e,n,o={},l="max")=>{const i={};return $(n,e,{boost:{h:2,t:1,c:4},prefix:!0,...o}).forEach(s=>{const{id:t,terms:d,score:r}=s,c=t.includes("@"),f=t.includes("#"),[p,m]=t.split(/[#@]/),h=Number(p),y=d.sort((u,a)=>u.length-a.length).filter((u,a)=>d.slice(a+1).every(g=>!g.includes(u))),{contents:x}=i[h]??={title:"",contents:[]};if(c)x.push([{type:"customField",id:h,index:m,display:y.map(u=>s.c.map(a=>S(a,u))).flat().filter(u=>u!==null)},r]);else{const u=y.map(a=>S(s.h,a)).filter(a=>a!==null);if(u.length&&x.push([{type:f?"heading":"title",id:h,...f&&{anchor:m},display:u},r]),"t"in s&&s.t)for(const a of s.t){const g=y.map(M=>S(a,M)).filter(M=>M!==null);g.length&&x.push([{type:"text",id:h,...f&&{anchor:m},display:g},r])}}}),k(i).sort(([,s],[,t])=>(l?I:N)(s,t)).map(([s,{title:t,contents:d}])=>{if(!t){const r=w(n,s);r&&(t=r.h)}return{title:t,contents:d.map(([r])=>r)}})},C=(e,n,o={})=>{const l=L(n,e,{fuzzy:.2,maxFuzzy:3,...o}).map(({suggestion:i})=>i);return e.includes(" ")?l:l.filter(i=>!i.includes(" "))};self.onmessage=async({data:{type:e="all",query:n,locale:o="/",options:l,id:i}})=>{const{default:s}=await F[o](),t=O(s,{fields:["h","t","c"],storeFields:["h","t","c"]});e==="suggest"?self.postMessage([e,i,C(n,t,l)]):e==="search"?self.postMessage([e,i,z(n,t,l,b)]):self.postMessage({suggestions:[e,i,C(n,t,l)],results:[e,i,z(n,t,l,b)]})};
//# sourceMappingURL=worker.js.map
