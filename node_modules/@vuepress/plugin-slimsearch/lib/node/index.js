import{entries as v,fromEntries as T,isArray as A,keys as q,Logger as O,ensureEndingSlash as D,getFullLocaleConfig as I,addViteOptimizeDepsInclude as P,addViteSsrNoExternal as j}from"@vuepress/helper";import{watch as F}from"chokidar";import{load as $}from"cheerio";import{createIndex as J,addAllAsync as K,discard as E,addAll as M,vacuum as z}from"slimsearch";import{path as H,getDirname as W,fs as S}from"vuepress/utils";const V="h2,h3,h4,h5,h6".split(","),B="header,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,tfoot,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,pre".split(","),G="routelink,routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),U=e=>e.type==="comment"&&e.data.trim()==="more",Z=$(""),X=e=>(e.children.length===1&&e.children[0].type==="tag"&&e.children[0].tagName==="a"&&e.children[0].attribs.class==="header-anchor"&&(e.children=e.children[0].children[0].children),e.children.map(t=>t.type==="text"?t.data:null).filter(Boolean).join(" ").replace(/\s+/gu," ").trim()),L=(e,t,a=[],r=!1)=>{const i=t.addPath(e.path).toString(),n=!!e.data.excerpt,l={id:i,h:e.title},o=[l];let d=n||r,c=null,u="",h=!1;const y=()=>{u&&d&&(((h?c:l).t??=[]).push(u.replace(/[\n\s]+/gu," ")),u="")},f=(s,p=!1)=>{if(s.type==="tag")if(V.includes(s.name)){const{id:m}=s.attribs,k=X(s);y(),m?(h?o.push(c):h=!0,c={id:`${i}#${m}`,h:k}):k&&((c??l).t??=[]).push(k)}else B.includes(s.name)?(y(),s.childNodes.forEach(m=>{f(m,p||s.name==="pre")})):G.includes(s.name)&&s.childNodes.forEach(m=>{f(m,p)});else s.type==="text"?u+=p||s.data.trim()?s.data:"":n&&!r&&U(s)&&(d=!1)},x=Z.parseHTML(e.contentRendered)??[],R=T(a.map(({getter:s},p)=>{const m=s(e);return A(m)?[p.toString(),m]:m?[p.toString(),[m]]:null}).filter(s=>s!==null));return!x.length&&!q(R).length?[]:(x.forEach(s=>{f(s)}),y(),c&&o.push(c),v(R).forEach(([s,p])=>{o.push({id:`${i}@${s}`,c:p})}),o)},Y=async(e,{customFields:t,indexContent:a,filter:r=()=>!0,indexOptions:i,indexLocaleOptions:n},l)=>{const o={};e.pages.forEach(c=>{r(c)&&c.frontmatter.search!==!1&&(o[c.pathLocale]??=[]).push(...L(c,l,t,a))});const d={};return await Promise.all(v(o).map(async([c,u])=>{const h=J({...i,...n?.[c],fields:["h","t","c"],storeFields:["h","a","t","c"]});await K(h,u),d[c]=h})),d},_=import.meta.dirname||W(import.meta.url),w="@vuepress/plugin-slimsearch",Q=new O(w),ee=D(H.resolve(_,"../client/")),te=H.resolve(_,"../worker/index.js"),g=e=>e.replace(/\//g,"")||"root",C=e=>e.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/README.md").replace(/\.html\.vue/,".md"),ae=async(e,t,a)=>{const r=e.dir.dest(t.worker??"slimsearch.worker.js"),i=JSON.stringify(a),n=await S.readFile(te,"utf8");await S.ensureDir(H.dirname(r)),await S.writeFile(r,n.replace("__SLIMSEARCH_INDEX__",()=>JSON.stringify(i)).replace("__SLIMSEARCH_SORT_STRATEGY__",JSON.stringify(t.sortStrategy??"max")))},ie=[[["en","en-US"],{cancel:"Cancel",placeholder:"Search",search:"Search",clear:"Clear search query",remove:"Delete current item",searching:"Searching",defaultTitle:"Documentation",select:"to select",navigate:"to navigate",autocomplete:"to autocomplete",exit:"to exit",queryHistory:"Search History",resultHistory:"Result History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."}],[["zh","zh-CN","zh-Hans"],{cancel:"取消",placeholder:"搜索",search:"搜索",clear:"清除搜索文字",remove:"删除当前项目",searching:"搜索中",defaultTitle:"文档",select:"选择",navigate:"切换",autocomplete:"自动补全",exit:"关闭",queryHistory:"搜索历史",resultHistory:"历史结果",emptyHistory:"无搜索历史",emptyResult:"没有找到结果",loading:"正在加载搜索索引..."}],[["zh-TW","zh-Hant"],{cancel:"取消",placeholder:"搜索",search:"搜索",clear:"清除搜索文字",remove:"刪除當前項目",searching:"搜索中",defaultTitle:"文檔",select:"選擇",navigate:"切換",autocomplete:"自動補全",exit:"關閉",queryHistory:"搜索歷史",resultHistory:"歷史結果",emptyHistory:"無搜索歷史",emptyResult:"沒有找到結果",loading:"正在加載搜索索引..."}],[["de","de-DE"],{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",clear:"Suchanfrage löschen",remove:"Aktuellen Eintrag löschen",searching:"Suche",defaultTitle:"Dokumentation",select:"auswählen",navigate:"wechseln",autocomplete:"automatisch vervollständigen",exit:"schließen",queryHistory:"Suchverlauf",resultHistory:"Ergebnisverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."}],[["vi","vi-VN"],{cancel:"Hủy",placeholder:"Tìm kiếm",search:"Tìm kiếm",clear:"Xóa tìm kiếm",remove:"Xóa mục hiện tại",searching:"Đang tìm kiếm",defaultTitle:"Tài liệu",select:"chọn",navigate:"chuyển",autocomplete:"tự động hoàn thành",exit:"đóng",queryHistory:"Lịch sử tìm kiếm",resultHistory:"Lịch sử kết quả",emptyHistory:"Xóa lịch sử tìm kiếm",emptyResult:"Không tìm thấy kết quả",loading:"Đang tải chỉ mục tìm kiếm..."}],[["uk"],{cancel:"Скасувати",placeholder:"Пошук",search:"Пошук",clear:"очистити пошуковий запит",remove:"Видалити поточний елемент",searching:"Пошук",defaultTitle:"Документація",select:"вибрати",navigate:"перейти",autocomplete:"автозаповнення",exit:"закрити",queryHistory:"Історія пошуку",resultHistory:"Історія результатів",emptyHistory:"Очистити історію пошуку",emptyResult:"Нічого не знайдено",loading:"Завантаження пошукових індексів..."}],[["ru","ru-RU"],{cancel:"Отмена",placeholder:"Поиск",search:"Поиск",clear:"Очистить поисковый запрос",remove:"Удалить текущий элемент",searching:"Поиск",defaultTitle:"Документация",select:"выбрать",navigate:"переключить",autocomplete:"автозаполнение",exit:"закрыть",queryHistory:"История поиска",resultHistory:"История результатов",emptyHistory:"Очистить историю поиска",emptyResult:"Ничего не найдено",loading:"Загрузка поисковых индексов..."}],[["br"],{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",clear:"Limpar pesquisa",remove:"Remover item atual",searching:"Pesquisando",defaultTitle:"Documentação",select:"selecionar",navigate:"navegar",autocomplete:"autocompletar",exit:"fechar",queryHistory:"Histórico de pesquisa",resultHistory:"Histórico de resultados",emptyHistory:"Limpar histórico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando índices de pesquisa..."}],[["pl","pl-PL"],{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",clear:"Wyczyść zapytanie",remove:"Usuń bieżący element",searching:"Szukanie",defaultTitle:"Dokumentacja",select:"wybierz",navigate:"przejdź",autocomplete:"autouzupełnianie",exit:"zamknij",queryHistory:"Historia wyszukiwania",resultHistory:"Historia wyników",emptyHistory:"Wyczyść historię wyszukiwania",emptyResult:"Nie znaleziono wyników",loading:"Ładowanie indeksów wyszukiwania..."}],[["sk","sk-SK"],{cancel:"Zrušiť",placeholder:"Hľadať",search:"Hľadať",clear:"Vymazať vyhľadávanie",remove:"Odstrániť aktuálny prvok",searching:"Hľadanie",defaultTitle:"Dokumentácia",select:"vybrať",navigate:"prepnúť",autocomplete:"automatické dopĺňanie",exit:"zavrieť",queryHistory:"História vyhľadávania",resultHistory:"História výsledkov",emptyHistory:"Vymazať históriu vyhľadávania",emptyResult:"Nenašli sa žiadne výsledky",loading:"Načítavajú sa vyhľadávacie indexy..."}],[["fr","fr-FR"],{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",clear:"Effacer la recherche",remove:"Supprimer l'élément actuel",searching:"Recherche",defaultTitle:"Documentation",select:"sélectionner",navigate:"naviguer",autocomplete:"auto-complétion",exit:"fermer",queryHistory:"Historique de recherche",resultHistory:"Historique des résultats",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun résultat trouvé",loading:"Chargement des index de recherche..."}],[["es","es-ES"],{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",clear:"Limpiar búsqueda",remove:"Eliminar elemento actual",searching:"Buscando",defaultTitle:"Documentación",select:"seleccionar",navigate:"navegar",autocomplete:"autocompletar",exit:"cerrar",queryHistory:"Historial de búsqueda",resultHistory:"Historial de resultados",emptyHistory:"Vaciar historial de búsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando índices de búsqueda..."}],[["ja","ja-JP"],{cancel:"キャンセル",placeholder:"検索",search:"検索",clear:"検索文字列をクリア",remove:"現在の項目を削除",searching:"検索中",defaultTitle:"ドキュメント",select:"選択",navigate:"切り替え",autocomplete:"オートコンプリート",exit:"閉じる",queryHistory:"検索履歴",resultHistory:"結果履歴",emptyHistory:"検索履歴をクリア",emptyResult:"結果が見つかりません",loading:"検索インデックスを読み込んでいます..."}],[["tr","tr-TR"],{cancel:"İptal",placeholder:"Ara",search:"Ara",clear:"Arama metnini temizle",remove:"Geçerli öğeyi sil",searching:"Aranıyor",defaultTitle:"Dökümantasyon",select:"seç",navigate:"geç",autocomplete:"otomatik tamamlama",exit:"kapat",queryHistory:"Arama geçmişi",resultHistory:"Sonuç geçmişi",emptyHistory:"Arama geçmişini temizle",emptyResult:"Sonuç bulunamadı",loading:"Arama dizinleri yükleniyor..."}],[["ko","ko-KO"],{cancel:"취소",placeholder:"검색",search:"검색",clear:"검색어 지우기",remove:"현재 항목 삭제",searching:"검색 중",defaultTitle:"문서",select:"선택",navigate:"이동",autocomplete:"자동 완성",exit:"닫기",queryHistory:"검색 기록",resultHistory:"결과 기록",emptyHistory:"검색 기록 지우기",emptyResult:"결과를 찾을 수 없습니다",loading:"검색 인덱스를 로드하는 중..."}],[["fi","fi-FI"],{cancel:"Peruuta",placeholder:"Etsi",search:"Etsi",clear:"Tyhjennä hakukysely",remove:"Poista nykyinen kohde",searching:"Etsitään",defaultTitle:"Dokumentaatio",select:"valitaksesi",navigate:"navigoidaksesi",autocomplete:"automaattinen täydennys",exit:"poistuaksesi",queryHistory:"Hakuhistoria",resultHistory:"Tuloshistoria",emptyHistory:"Tyhjennä hakuhistoria",emptyResult:"Tuloksia ei löytynyt",loading:"Ladataan hakuindeksiä..."}],[["hu","hu-HU"],{cancel:"Mégse",placeholder:"Keresés",search:"Keresés",clear:"Keresési kifejezés törlése",remove:"Aktuális elem törlése",searching:"Keresés",defaultTitle:"Dokumentáció",select:"kiválasztáshoz",navigate:"navigáláshoz",autocomplete:"automatikus kiegészítés",exit:"kilépéshez",queryHistory:"Keresési előzmények",resultHistory:"Eredmények előzményei",emptyHistory:"Üres keresési előzmények",emptyResult:"Nincs találat",loading:"A keresési indexek betöltése..."}],[["id","id-ID"],{cancel:"Batal",placeholder:"Cari sesuatu",search:"Cari",clear:"Hapus pencarian",remove:"Hapus item saat ini",searching:"Sedang mencari",defaultTitle:"Dokumentasi",select:"pilih",navigate:"navigasi",autocomplete:"autoselesai",exit:"keluar",queryHistory:"Riwayat Penelusuran",resultHistory:"Riwayat Hasil",emptyHistory:"Tidak ada riwayat penelusuran",emptyResult:"Hasil penelusuran tidak tersedia",loading:"Memuat indeks penelusuran..."}],[["nl","nl-NL"],{cancel:"Annuleren",placeholder:"Zoeken",search:"Zoeken",clear:"Zoekopdracht wissen",remove:"Verwijder huidig item",searching:"Zoeken",defaultTitle:"Documentatie",select:"Selecteren",navigate:"to navigate",autocomplete:"autocompletion",exit:"to exit",queryHistory:"Zoekgeschiedenis",resultHistory:"Resultaatgeschiedenis",emptyHistory:"Zoekgeschiedenis Leegmaken",emptyResult:"Geen resultaten gevonden",loading:"Laden van zoekindexen..."}]];class re{store;constructor(){this.store=[]}addPath(t){const a=this.store.indexOf(t);return a===-1?(this.store.push(t),this.store.length-1):a}addPaths(t){return t.map(a=>this.addPath(a))}deletePath(t){const a=this.store.indexOf(t);a!==-1&&(this.store[a]="")}clear(){this.store=[]}toJSON(){return JSON.stringify(this.store)}}const se=async(e,t)=>{await e.writeTemp("slimsearch/store.js",`export const store = ${t.toJSON()}
`)},le=async(e,t)=>{await Promise.all(v(t).map(([a,r])=>e.writeTemp(`slimsearch/${g(a)}.js`,`export default ${JSON.stringify(JSON.stringify(r))}`))),await e.writeTemp("slimsearch/index.js",`export default {${q(t).map(a=>`${JSON.stringify(a)}: () => import('./${g(a)}.js')`).join(",")}}`)},ne=async(e,t)=>{await e.writeTemp("slimsearch/worker-options.js",`export const sortStrategy = "${t.sortStrategy??"max"}"
`)},N=async(e,t,a,r,i)=>{const n=C(i),l=e.pages.find(({filePathRelative:o})=>o?.toLowerCase()===n.toLowerCase());if(l){const o=L(l,r,t.customFields,t.indexContent),{pathLocale:d}=l,c=r.addPath(l.path).toString(),u=a[d];Array.from(u._documentIds.values()).filter(y=>y.startsWith(c)).forEach(y=>{E(u,y)}),M(u,o),await z(u);const h=`export default ${JSON.stringify(JSON.stringify(u))}
`;await e.writeTemp(`slimsearch/${g(d)}.js`,h)}},oe=async(e,t,a,r)=>{const i=C(r),n=e.pages.find(({filePathRelative:l})=>l?.toLowerCase()===i.toLowerCase());if(n){const{pathLocale:l}=n,o=a.addPath(n.path).toString(),d=t[l];Array.from(d._documentIds.values()).filter(u=>u.startsWith(o)).forEach(u=>{E(d,u)}),await z(d);const c=`export default ${JSON.stringify(JSON.stringify(d))}
`;await e.writeTemp(`slimsearch/${g(l)}.js`,c)}},ce=(e={})=>t=>{t.env.isDebug&&Q.info("Options:",e);const a=new re;let r=null;return{name:w,define:{__SLIMSEARCH_SUGGESTION__:e.suggestion??!0,__SLIMSEARCH_CUSTOM_FIELDS__:T(e.customFields?.map(({formatter:i},n)=>i?[n.toString(),i]:null).filter(i=>i!==null)??[]),__SLIMSEARCH_LOCALES__:I({app:t,name:w,config:e.locales,default:ie}),__SLIMSEARCH_OPTIONS__:{searchDelay:e.searchDelay??150,suggestDelay:e.suggestDelay??0,queryHistoryCount:e.queryHistoryCount??5,resultHistoryCount:e.resultHistoryCount??5,hotKeys:e.hotKeys??[{key:"k",ctrl:!0},{key:"/",ctrl:!0}],worker:e.worker??"slimsearch.worker.js"}},clientConfigFile:`${ee}config.js`,extendsBundlerOptions:i=>{P(i,t,"slimsearch",!0),j(i,t,["@vuepress/helper","fflate","vuepress-shared"])},onInitialized:async()=>{r=await Y(t,e,a)},onPrepared:async()=>{const{isBuild:i,isDev:n}=t.env;await Promise.all([n?le(t,r):null,se(t,a),n?ne(t,e):null]),i&&a.clear()},onWatched:(i,n)=>{if(e.hotReload??t.env.isDebug){const l=F("pages/**/*.vue",{cwd:t.dir.temp(),ignoreInitial:!0});l.on("add",o=>{N(t,e,r,a,o)}),l.on("change",o=>{N(t,e,r,a,o)}),l.on("unlink",o=>{oe(t,r,a,o)}),n.push(l)}},onGenerated:()=>ae(t,e,r)}};var b=(e=>(e.Heading="h",e.Anchor="a",e.Text="t",e.CustomFields="c",e))(b||{});export{b as IndexField,ce as slimsearchPlugin};
//# sourceMappingURL=index.js.map
